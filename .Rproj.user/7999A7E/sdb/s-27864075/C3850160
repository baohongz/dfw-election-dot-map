{
    "collab_server" : "",
    "contents" : "library(tidyverse)\nlibrary(readxl)\nlibrary(maptools)\nlibrary(stringr)\n\nprocess_tarrant <- function(path_to_excel = \"data-raw/tarrant/tarrant_nov9.xlsx\") {\n  \n  # Issue - weird file mismatch.  Open in Excel and save as \"tarrant_nov9.xlsx\"\n  df <- read_excel(path_to_excel, sheet = 26, skip = 2)\n  \n  # Keep the Precinct and total votes columns (every 4th col starting w/col 6)\n  # plus overall Total\n  cols <- c(1, seq(6, 70, 4), 71)\n  \n  sub <- df[,cols]\n  \n  nms <- c(\"precinct\", \"trump\", \"clinton\", \"johnson\", \"stein\", \n           paste0(\"other\", 1:13), \"total\")\n  \n  names(sub) <- nms\n  \n  sub$precinct <- paste0(\"439\", sub$precinct)\n  \n  # Sum up the \"other\" columns\n  sub$other <- rowSums(sub[6:18])\n  \n  sub1 <- sub %>%\n    select(precinct:stein, other, total) %>%\n    filter(precinct != \"439Total:\")\n  \n  return(sub1)\n\n}\n\n\nprocess_dallas <- function(path_to_excel = \"data-raw/dallas/dallas_nov9.xlsx\") {\n  \n  # Read in the sheet\n  df <- read_excel(path_to_excel, sheet = 4, skip = 2)\n  \n  # Keep precinct and totals for the four candidates\n  cols <- c(1, seq(8, 26, 6))\n  \n  sub <- df[,cols]\n  \n  names(sub) <- c(\"precinct\", \"trump\", \"clinton\", \n                  \"johnson\", \"stein\")\n  \n  # Clean up the \"precinct\" column; will require group sums\n  \n  # Retain the number before the dash\n  sub1 <- sub %>%\n    filter(precinct != \"Total:\") %>%\n    mutate(precinct = paste0(\"113\", \n                             str_sub(precinct, 1, 4))) %>%\n    group_by(precinct) %>%\n    summarize(trump = sum(trump), \n              clinton = sum(clinton), \n              johnson = sum(johnson), \n              stein = sum(stein))\n  \n  return(sub1)\n  \n}\n\n\nprocess_denton <- function(path_to_excel = \"data-raw/denton/denton_nov9.xlsx\") {\n  \n  # Read in the sheet\n  df <- read_excel(path_to_excel, sheet = 4, skip = 2)\n  \n  cols <- c(1, seq(6, 18, 4))\n  \n  sub <- df[,cols]\n  \n  names(sub) <- c(\"precinct\", \"trump\", \"clinton\", \n                  \"johnson\", \"stein\")\n  \n  sub1 <- sub %>%\n    filter(precinct != \"Total:\") %>%\n    mutate(precinct = paste0(\"121\", precinct))\n  \n  return(sub1)\n}\n\n\n# Some info about Collin - there are some new precincts\n# not in the shapefile.  They are precincts 210-214.  \n# \n# 210: was part of 25\n# 211: was part of 38\n# 212: was part of 134\n# 213: was part of 163\n# 214: was part of 178\n\nprocess_collin <- function() {\n  \n  trump <- read_csv(\"data/tabula-collin_trump1.csv\")\n  \n  trump_total <- trump %>%\n    rename(X1 = `Jurisdiction Wide`) %>%\n    filter(X1 == \"Total\" | grepl(\"PCT\", X1)) %>%\n    select(X1, X9) %>%\n    mutate(trump = lead(X9)) %>%\n    filter(X1 != \"Total\") %>%\n    select(precinct = X1, trump) %>%\n    mutate(trump = as.integer(str_replace(trump, \"\\\\s[^ ]+$\", \"\")))\n  \n  other <- read_csv(\"data/tabula-collin_other1.csv\") %>%\n    rename(X3 = `President/Vice-President`) %>%\n    filter(X1 == \"Total\" | grepl(\"PCT\", X1)) %>%\n    select(X1:X4) %>%\n    # Shift over problem rows\n    mutate(X3 = ifelse(is.na(X3), X4, X3)) %>%\n    select(-X4) %>%\n    mutate(clinton_temp = lead(X2), \n           js_temp = lead(X3)) %>%\n    filter(X1 != \"Total\") %>%\n    mutate(clinton = as.integer(str_replace(clinton_temp, \n                                            \"\\\\s[^ ]+$\", \"\")), \n           johnson = as.integer(sub(\" .*\", \"\", js_temp)), \n           stein_temp = str_sub(js_temp, start = -8, end = -1)) %>%\n    mutate(stein = as.integer(str_sub(stein_temp, 1, 2))) %>%\n    select(precinct = X1, clinton, johnson, stein)\n  \n  full <- left_join(trump_total, other, by = \"precinct\") %>%\n    # Group new precincts together to correspond with shapes\n    mutate(precinct = ifelse(precinct == \"PCT 210\", \"PCT 25\", \n                             ifelse(precinct == \"PCT 211\", \"PCT 38\", \n                                    ifelse(precinct == \"PCT 212\", \"PCT 134\", \n                                           ifelse(precinct == \"PCT 213\", \"PCT 163\", \n                                                  ifelse(precinct == \"PCT 214\", \"PCT 178\", precinct)))))) %>%\n    group_by(precinct) %>%\n    summarize_all(sum) %>%\n    ungroup() %>%\n    mutate(precinct = paste0(\"85\", str_pad(str_replace(precinct, \"PCT \", \"\"), width = 4, \n                                           side = \"left\", pad = \"0\")))\n  \n  \n    return(full)\n    \n  \n}\n\nprocess_rockwall <- function(path_to_excel = \"data-raw/rockwall/rockwall_nov10.xlsx\") {\n  \n  df <- read_excel(path_to_excel, sheet = 4, skip = 2)\n  \n  cols <- c(1, seq(8, 32, 6), 33)\n  \n  sub <- df[,cols]\n  \n  names(sub) <- c(\"precinct\", \"trump\", \"clinton\", \"johnson\", \n                  \"stein\", \"other\", \"total\")\n  \n  sub1 <- sub %>%\n    filter(precinct != \"Total:\") %>%\n    mutate(precinct = paste0(\"397\", str_pad(precinct, 4, \"left\", \"0\")))\n  \n  return(sub1)\n  \n  \n}\n  \n\n\n\nvotes_to_xy <- function(vtds, scaling_factor = 1) {\n  \n  values <- c(\"trump\", \"clinton\", \"johnson\", \"stein\")\n  \n  xys <- bind_rows(\n    lapply(values, function(value) {\n      \n      vtds[[value]] <- as.integer(vtds[[value]] / scaling_factor)\n      \n      dots <- dotsInPolys(vtds, vtds[[value]])\n      \n      proj4string(dots) <- proj4string(vtds)\n      \n      dots_xy <- spTransform(dots, CRS(\"+proj=longlat +datum=WGS84\"))\n      \n      dots_xy$longitude <- coordinates(dots_xy)[,1]\n      dots_xy$latitude <- coordinates(dots_xy)[,2]\n      \n      dots_xy$candidate <- value\n      \n      return(dots_xy@data)\n      \n    })\n  )\n  \n}\n\n",
    "created" : 1478747458262.000,
    "dirty" : false,
    "encoding" : "UTF-8",
    "folds" : "",
    "hash" : "268951936",
    "id" : "C3850160",
    "lastKnownWriteTime" : 1478876022,
    "last_content_update" : 1478876022121,
    "path" : "D:/Users/kylewalker/Box Sync/Center for Urban Studies/election/R/functions.R",
    "project_path" : "R/functions.R",
    "properties" : {
        "tempName" : "Untitled1"
    },
    "relative_order" : 1,
    "source_on_save" : false,
    "source_window" : "",
    "type" : "r_source"
}